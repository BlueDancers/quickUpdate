# è½»é‡çº§æ›´æ–°è„šæœ¬

## ç®€ä»‹

â€‹ é€šè¿‡ç®€å•çš„é…ç½®ï¼Œå°±å¯ä»¥ä¸€è¡Œå‘½ä»¤å°†å½“å‰é¡¹ç›®æ‰“åŒ…åˆ°æœåŠ¡ç«¯å®Œæˆå‰ç«¯é¡¹ç›®çš„æ›´æ–°ï¼Œé€‚ç”¨äºä¸ªäººé¡¹ç›®

â€‹ é¿å…æœ¬åœ°æ‰“åŒ…ï¼Œå† ğŸ”—ssh ç­‰åé¢ä¸€ç³»åˆ—çš„ç¹çæ“ä½œï¼Œå¤§å¹…æé«˜æ›´æ–°æ•ˆç‡

## ä½¿ç”¨æ•™ç¨‹

1. **å…¨å±€å®‰è£…ä¾èµ–**

```bash
npm i quickupdate -g
```

2. **åœ¨é¡¹ç›®ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶`update.config.cjs`**

```js
/**
 * æ›´æ–°é…ç½®
 * @param {String} objName å½“å‰æ›´æ–°åç§°
 * @returns
 */
module.exports = (objName) => {
  return {
    host: '0.0.0.0', // å¡«å†™æœåŠ¡å™¨åœ°å€
    username: 'root', // æœåŠ¡å™¨ç”¨æˆ·å
    password: '123456', // æœåŠ¡å™¨å¯†ç 
    port: '22', // ç«¯å£å·
    buildCmd: 'npm run build', // æ›´æ–°å‘½ä»¤åç§°
    buildPath: '/admin', // ä½ çš„é¡¹ç›®æ‰“åŒ…è·¯å¾„ä¾‹å¦‚ /dist
    uploadDir: '/usr/share/nginx ', // åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œä¾‹å¦‚å¡«å†™çš„
    objname: objName, // å›ºå®šå†™æ³• æ˜¯æ›´æ–°è„šæœ¬åé¢çš„åç§°ï¼ˆä¸‹é¢ä¼šè§åˆ°ï¼‰
    backObject: '', // å¤‡ä»½çš„æ–‡ä»¶å¤¹åç§° å¦‚æœæ›´æ–°å‘½ä»¤æ˜¯ quickupdate dist è¿™é‡Œå¡«å†™äº†distï¼Œå°†ä¼šå°†å†å²çº¿ä¸Šä»£ç è‡ªåŠ¨å¤‡ä»½åˆ°dist_backä¸­ å¦‚æœä¸å¡«å°±ä¸ä¼šåœ¨æœåŠ¡å™¨ä¸Šå¤‡ä»½
  }
}
```

3. **å¼€å§‹ç¬¬ä¸€æ¬¡å‘½ä»¤æ›´æ–°**

> å‡è®¾ä½ çš„é¡¹ç›®åœ¨æœåŠ¡å™¨ä¸­çš„è·¯å¾„ä¸º /usr/share/nginx/adminï¼Œé…ç½®æ–‡ä»¶ uploadDir å¡«å†™ä¸º/usr/share/nginxï¼Œåˆ™æ›´æ–°å‘½ä»¤ä¸º

```bash
quickupdate admin æˆ–è€… qup admin // qupä¸ºquickupdateçš„ç®€å†™
```

ä¹‹åå°†ä¼šå‡ºç°è¯¢é—®

```
æ‚¨æ­£åœ¨å°†ä»£ç æ›´æ–°åˆ°æœåŠ¡å™¨,å›è½¦å°†ä¼šç»§ç»­æ‰§è¡Œ
```

æŒ‰å›è½¦å³å¯ï¼Œä¹‹åå˜å›æ‰§è¡Œæ‰“åŒ… å‘é€åˆ°æœåŠ¡å™¨çš„è„šæœ¬ï¼Œç»“æŸåå°†ä¼šçœ‹åˆ°

```
æ€»å…± x.xx MB,å®Œæˆæºä»£ç å‹ç¼©
ç¨‹åºzipä¸Šä¼ æˆåŠŸ,åˆ¤æ–­çº¿ä¸Šæ˜¯å¦éœ€è¦å¤‡ä»½
å½“å‰æ— éœ€å¤‡ä»½,ç›´æ¥è§£å‹ä¸Šä¼ å‹ç¼©åŒ…
é¡¹ç›®åŒ…å®Œæˆè§£å‹,adminé¡¹ç›®éƒ¨ç½²æˆåŠŸäº†!
é¡¹ç›®æ›´æ–°æ—¶é•¿12.663s
æœ¬åœ°ç¼“å­˜zipæ¸…é™¤å®Œæ¯•
çº¿ä¸Šé¡¹ç›®.DS_Storeåˆ é™¤å®Œæˆ
```

å¦‚æœçœ‹åˆ°è¿™ä¸ªå°±æ­å–œæ‚¨æ›´æ–°æˆåŠŸäº†ï¼Œå®Œæˆäº†ä¸€è¡Œå‘½ä»¤å°†æœ¬åœ°ä»£ç æ‰“åŒ…åˆ°æœåŠ¡å™¨

### æ³¨æ„ï¼

- ä¸è¦å¿˜è®°å°†å†™å…¥æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶`update.config.cjs`åŠ å…¥`.gitignore`ï¼Œå¦åˆ™ä½ çš„æ•æ„Ÿä¿¡æ¯å°†ä¼šè¢«ä¸Šä¼ åˆ°ä»£ç åº“ä¸­ï¼ï¼

- å¦‚æœå‘ç°ä¸Šä¼ åˆ°æœåŠ¡ç«¯çš„ zip æ–‡ä»¶æ²¡æœ‰æ²¡è§£å‹ï¼Œè¯·å‰å¾€æœåŠ¡å™¨ä¸­æµ‹è¯• unzip å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼ˆè¾“å…¥ unzip ç„¶åå›è½¦ï¼‰ï¼Œå¦‚æœæç¤º`unzip: command not found`ï¼Œå°±æ‰§è¡Œå‘½ä»¤è¿›è¡Œå®‰è£…`yum install -y unzip zip`ã€‚

## é«˜é˜¶é…ç½®

### é™åˆ¶æ›´æ–°åç§°

> å‘½ä»¤ä¸­æœ€åé™„å¸¦çš„æ›´æ–°åç§°å°†ä¼šè¢«ä¼ å›ä½ çš„é…ç½®å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å‡½æ•°ä¸­å¯ä»¥è¿›è¡Œé€»è¾‘æ ¡éªŒ

```js
let whiteList = ['dist']
/**
 * æ›´æ–°é…ç½®
 * @param {String} objName å½“å‰æ›´æ–°åç§°
 * @returns
 */
module.exports = (objName) => {
  if (!whiteList.includes(objName)) {
    console.log('å½“å‰é¡¹ç›®ä¸å­˜åœ¨æ‚¨è¾“å…¥çš„æ›´æ–°å‘½ä»¤,è¯·æ£€æŸ¥æ›´æ–°åç§°')
    process.exit(0)
  }
  return {
    // ....
  }
}
```

### å¤šç¯å¢ƒéƒ¨ç½²

> å‡è®¾æ‚¨çš„å‰ç«¯é¡¹ç›®å­˜åœ¨å¤šä¸ªç¯å¢ƒ ä½ å¸Œæœ›å¯ä»¥é€šè¿‡å‘½ä»¤å¤‡ä»½æ­£å¼ç¯å¢ƒä»£ç ï¼Œå…¶ä»–ç¯å¢ƒå¿½ç•¥ï¼Œè¿™å¯ä»¥å¯ç”¨å‚æ•° backObject

```js
let whiteList = ['dist', 'dist-pre']
/**
 * æ›´æ–°é…ç½®
 * @param {String} objName å½“å‰æ›´æ–°åç§°
 * @returns
 */
module.exports = (objName) => {
  if (!whiteList.includes(objName)) {
    console.log('å½“å‰é¡¹ç›®ä¸å­˜åœ¨æ‚¨è¾“å…¥çš„æ›´æ–°å‘½ä»¤,è¯·æ£€æŸ¥æ›´æ–°åç§°')
    process.exit(0)
  }
  return {
    // ....
    backObject: 'dist',
  }
}
```

ç¥ä½ å¼€å‘æ„‰å¿«ï¼
